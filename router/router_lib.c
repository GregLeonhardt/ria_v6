/*******************************  COPYRIGHT  ********************************/
/**
 *  Author? "Gregory N. Leonhardt"
 *  License? "CC BY-NC 2.0"
 *           "https://creativecommons.org/licenses/by-nc/2.0/"
 *
 ****************************************************************************/

/******************************** JAVADOC ***********************************/
/**
 *  This file contains private functions that makeup the internal
 *  library components of the 'router' library.
 *
 *  @note
 *
 ****************************************************************************/

/****************************************************************************
 *  Compiler directives
 ****************************************************************************/


/****************************************************************************
 * System Function API
 ****************************************************************************/

                                //*******************************************
#include <stdint.h>             //  Alternative storage types
#include <stdbool.h>            //  TRUE, FALSE, etc.
#include <stdio.h>              //  Standard I/O definitions
                                //*******************************************
                                //*******************************************

/****************************************************************************
 * Application APIs
 ****************************************************************************/

                                //*******************************************
#include "global.h"             //  Global stuff for this application
#include "libtools_api.h"       //  My Tools Library
                                //*******************************************
#include "tcb_api.h"            //  API for all tcb_*               PUBLIC
#include "rcb_api.h"            //  API for all rcb_*               PUBLIC
                                //*******************************************
#include "router_api.h"         //  API for all router_*            PUBLIC
#include "router_lib.h"         //  API for all ROUTER__*           PRIVATE
                                //*******************************************

/****************************************************************************
 * Enumerations local to this file
 ****************************************************************************/

//----------------------------------------------------------------------------
//----------------------------------------------------------------------------

/****************************************************************************
 * Definitions local to this file
 ****************************************************************************/

//----------------------------------------------------------------------------
//----------------------------------------------------------------------------

/****************************************************************************
 * Structures local to this file
 ****************************************************************************/

//----------------------------------------------------------------------------
//----------------------------------------------------------------------------

/****************************************************************************
 * Storage Allocation local to this file
 ****************************************************************************/

//----------------------------------------------------------------------------
//----------------------------------------------------------------------------

/****************************************************************************
 * LIB Functions
 ****************************************************************************/

/****************************************************************************/
/**
 *  Choose the queue with the least number of queued objects
 *
 *  @param  tcb_p               Pointer to a Thread Control Block
 *
 *  @return                     Upon successful completion PASS is returned
 *                              else FAIL is returned
 *
 ****************************************************************************/

int
ROUTER__choose(
    struct  tcb_t           *   tcb_p[ ],
    int                         count
    )
{
    /**
     * @param thread_id         Unique thread id number                     */
    int                         thread_id;
    /**
     *  @param  id              Thread ID with smallest queue               */
    int                         id;
    /**
     *  @param  queue_size      Queue size                                  */
    int                         queue_size;

    /************************************************************************
     *  Function Initialization
     ************************************************************************/


    /************************************************************************
     *  Function Body
     ************************************************************************/

    //  Set the base numbers
    id = 99999999;
    queue_size = 99999999;

    //  Locate the thread with the smallest queue depth
    for( thread_id = 0;
         thread_id < count;
         thread_id += 1 )
    {
        int                     queue_count;

        //  Get the queue count for this queue
        queue_count = queue_get_count( tcb_p[ thread_id ]->queue_id );

        //  Is it smaller than the current smallest ?
        if ( queue_count < queue_size )
        {
            //  YES:    Use this queue
            id = tcb_p[ thread_id ]->queue_id;
            queue_size = queue_count;
        }
    }

    /************************************************************************
     *  Function Exit
     ************************************************************************/

    //  DONE!
    return ( id );
}
/****************************************************************************/
